<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Supabase - Atlas Sports</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: white;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #334155;
        }
        button {
            background: #5865f2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover {
            background: #4752c4;
        }
        .success {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .error {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #334155;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #334155;
        }
        pre {
            background: #0f172a;
            padding: 10px;
            border-radius: 6px;
            overflow: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç Prueba de Conexi√≥n Supabase</h1>
    
    <div class="card">
        <h2>1. Configuraci√≥n</h2>
        <p><strong>URL:</strong> https://uqffsnrhasfqfcswkncf.supabase.co</p>
        <p><strong>Tabla a consultar:</strong> events</p>
        
        <button onclick="testConnection()">Probar Conexi√≥n</button>
        <button onclick="listTables()">Listar Tablas Disponibles</button>
        <button onclick="getEvents()">Obtener Eventos</button>
        
        <div id="result" class="success" style="display: none;"></div>
    </div>
    
    <div class="card">
        <h2>2. Resultados</h2>
        <div id="output"></div>
    </div>
    
    <script>
        const SUPABASE_URL = "https://uqffsnrhasfqfcswkncf.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVxZmZzbnJoYXNmcWZjc3drbmNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NzgyMDcsImV4cCI6MjA4NTE1NDIwN30.qVcKz8PuuEOBsObidm7Phmx-pw8iitYkH3Hzyc_E9Ak";
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function showMessage(text, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = text;
            resultDiv.className = isError ? 'error' : 'success';
            resultDiv.style.display = 'block';
        }
        
        async function testConnection() {
            try {
                showMessage("Conectando a Supabase...");
                
                // Prueba simple
                const { data, error } = await supabase
                    .from('events')
                    .select('count')
                    .limit(1);
                
                if (error) throw error;
                
                showMessage(`‚úÖ Conexi√≥n exitosa a Supabase`);
                
            } catch (error) {
                showMessage(`‚ùå Error: ${error.message}`, true);
                console.error("Error detallado:", error);
            }
        }
        
        async function listTables() {
            try {
                showMessage("Buscando tablas disponibles...");
                
                // Usamos una consulta a una tabla conocida para ver qu√© tablas existen
                const { data: events, error: eventsError } = await supabase
                    .from('events')
                    .select('*')
                    .limit(1);
                
                const { data: profiles, error: profilesError } = await supabase
                    .from('profiles')
                    .select('*')
                    .limit(1);
                
                const { data: tournaments, error: tournamentsError } = await supabase
                    .from('tournaments')
                    .select('*')
                    .limit(1);
                
                let output = '<h3>Tablas encontradas:</h3><ul>';
                
                if (!eventsError) output += '<li>‚úÖ <strong>events</strong> - Existe</li>';
                else output += `<li>‚ùå <strong>events</strong> - Error: ${eventsError.message}</li>`;
                
                if (!profilesError) output += '<li>‚úÖ <strong>profiles</strong> - Existe</li>';
                else output += `<li>‚ùå <strong>profiles</strong> - Error: ${profilesError.message}</li>`;
                
                if (!tournamentsError) output += '<li>‚úÖ <strong>tournaments</strong> - Existe</li>';
                else output += `<li>‚ùå <strong>tournaments</strong> - Error: ${tournamentsError.message}</li>`;
                
                output += '</ul>';
                
                document.getElementById('output').innerHTML = output;
                showMessage("‚úÖ Consulta de tablas completada");
                
            } catch (error) {
                showMessage(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        async function getEvents() {
            try {
                showMessage("Cargando eventos...");
                
                const { data, error } = await supabase
                    .from('events')
                    .select('*')
                    .order('start_date', { ascending: true });
                
                if (error) throw error;
                
                let output = `<h3>Eventos encontrados: ${data.length}</h3>`;
                
                if (data.length > 0) {
                    output += `<table>
                        <tr>
                            <th>ID</th>
                            <th>T√≠tulo</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Color</th>
                        </tr>`;
                    
                    data.forEach(event => {
                        output += `<tr>
                            <td>${event.id}</td>
                            <td>${event.title || 'Sin t√≠tulo'}</td>
                            <td>${event.start_date || 'Sin fecha'}</td>
                            <td>${event.end_date || 'Sin fecha'}</td>
                            <td style="background:${event.color || '#5865f2'}">${event.color || '#5865f2'}</td>
                        </tr>`;
                    });
                    
                    output += '</table>';
                    
                    // Mostrar datos crudos para debug
                    output += `<h4>Datos JSON:</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    output += '<p>No hay eventos en la tabla.</p>';
                }
                
                document.getElementById('output').innerHTML = output;
                showMessage(`‚úÖ Encontrados ${data.length} eventos`);
                
            } catch (error) {
                showMessage(`‚ùå Error: ${error.message}`, true);
                document.getElementById('output').innerHTML = 
                    `<div class="error"><strong>Error:</strong> ${error.message}<br>
                    <pre>${JSON.stringify(error, null, 2)}</pre></div>`;
            }
        }
        
        // Iniciar prueba autom√°tica al cargar
        document.addEventListener('DOMContentLoaded', async () => {
            showMessage("P√°gina cargada. Haz clic en 'Probar Conexi√≥n' para empezar.");
        });
    </script>
</body>
</html>
